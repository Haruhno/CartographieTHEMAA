<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modifier la formation</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        {% include 'includes/nav.html' %}

        <div class="main-content">
            <header>
                <div class="header-content">
                    <h1><i class="fas fa-edit"></i> Modifier la formation</h1>
                    <div class="user-info">
                        <a href="{{ url_for('utilisateur.deconnexion') }}" class="btn-logout">
                            <i class="fas fa-sign-out-alt"></i> Déconnexion
                        </a>
                    </div>
                </div>
            </header>

            <div class="content">
                <div class="form-container">
                    <form id="modificationForm" action="{{ url_for('formation.modify_with_reason') }}" method="POST">
                        <input type="hidden" name="id" value="{{ formation.id_formation }}">

                        <!-- Informations générales -->
                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-info-circle"></i> Informations générales</h2>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="nom" class="required-field">Nom de la formation</label>
                                    <input type="text" id="nom" name="nom" value="{{ formation.nom }}" required 
                                           class="form-control" placeholder="Nom de la formation">
                                </div>

                                <div class="form-group">
                                    <label for="type" class="required-field">Type de formation</label>
                                    <select id="type" name="type" required class="form-control">
                                        <option value="initiale" {% if formation.type == 'initiale' %}selected{% endif %}>Initiale</option>
                                        <option value="continue" {% if formation.type == 'continue' %}selected{% endif %}>Continue</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="description" class="required-field">Description</label>
                                <textarea id="description" name="description" required class="form-control" 
                                          rows="4" placeholder="Description détaillée de la formation">{{ formation.description }}</textarea>
                            </div>
                        </div>

                        <!-- Durée et dates -->
                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-clock"></i> Durée et dates</h2>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="duree" class="required-field">Durée</label>
                                    <input type="text" id="duree" name="duree" value="{{ formation.duree }}" required 
                                           class="form-control" placeholder="Ex: 3 semaines">
                                </div>

                                <div class="form-group">
                                    <label for="dates" class="required-field">Dates</label>
                                    <input type="text" id="dates" name="dates" value="{{ formation.dates }}" required 
                                           class="form-control" placeholder="Ex: Du 1er au 30 septembre 2024">
                                </div>
                            </div>
                        </div>

                        <!-- Lieu et prix -->
                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-map-marker-alt"></i> Lieu et tarif</h2>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="lieu" class="required-field">Lieu</label>
                                    <input type="text" id="lieu" name="lieu" value="{{ formation.lieu }}" required 
                                           class="form-control" placeholder="Adresse complète">
                                </div>

                                <div class="form-group">
                                    <label for="prix">Prix</label>
                                    <input type="number" id="prix" name="prix" value="{{ formation.prix }}" step="0.01" 
                                           class="form-control" placeholder="Prix en euros">
                                </div>
                            </div>
                        </div>

                        <!-- Informations complémentaires -->
                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-plus-circle"></i> Informations complémentaires</h2>
                            
                            <div class="form-group">
                                <label for="conditions_acces">Conditions d'accès</label>
                                <textarea id="conditions_acces" name="conditions_acces" class="form-control" 
                                          rows="3" placeholder="Prérequis, public visé...">{{ formation.conditions_acces }}</textarea>
                            </div>

                            <div class="form-group">
                                <label for="financement">Financement</label>
                                <input type="text" id="financement" name="financement" value="{{ formation.financement }}" 
                                       class="form-control" placeholder="Options de financement">
                            </div>

                            <div class="form-group">
                                <label for="presentation_intervenants">Présentation des intervenant·es</label>
                                <textarea id="presentation_intervenants" name="presentation_intervenants" class="form-control" 
                                          rows="3" placeholder="Expérience, spécialités...">{{ formation.presentation_intervenants }}</textarea>
                            </div>

                            <div class="form-group">
                                <label for="lien_inscription">Lien d'inscription</label>
                                <input type="url" id="lien_inscription" name="lien_inscription" 
                                       value="{{ formation.lien_inscription }}" class="form-control"
                                       pattern="https?://.+"
                                       placeholder="https://exemple.com"
                                       title="L'URL doit commencer par http:// ou https://">
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" id="submitModification">
                                <i class="fas fa-save"></i> Enregistrer les modifications
                            </button>
                            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Annuler
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de raison -->
    <div id="reasonModal" class="modal-overlay" style="display: none;">
        <div class="modal-box">
            <h3><i class="fas fa-pencil-alt"></i> Raison de la modification</h3>
            <p class="modal-description">
                Veuillez indiquer la raison de cette modification. Cette information sera utilisée pour le suivi des changements.
            </p>
            <textarea id="reasonText" maxlength="1000" placeholder="Décrivez brièvement la raison de cette modification..."></textarea>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="cancelReason">
                    <i class="fas fa-times"></i> Annuler
                </button>
                <button class="btn btn-primary" id="confirmReason">
                    <i class="fas fa-check"></i> Confirmer
                </button>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Validation du formulaire
            function validateForm() {
                let isValid = true;
                const requiredFields = document.querySelectorAll('[required]');
                
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        field.classList.add('error');
                        isValid = false;
                    } else {
                        field.classList.remove('error');
                    }
                });

                // Validation spécifique pour l'URL
                const urlField = document.getElementById('lien_inscription');
                if (urlField.value && !urlField.value.match(/^https?:\/\/.+/)) {
                    urlField.classList.add('error');
                    isValid = false;
                }

                return isValid;
            }

            // Gestion du modal
            $('#submitModification').click(function(e) {
                e.preventDefault();
                if (validateForm()) {
                    $('#reasonModal').show();
                }
            });

            $('#cancelReason').click(function() {
                $('#reasonModal').hide();
            });

            $('#confirmReason').click(function() {
                const reason = $('#reasonText').val().trim();
                if (!reason) {
                    alert('Veuillez indiquer une raison pour la modification');
                    return;
                }

                $('<input>').attr({
                    type: 'hidden',
                    name: 'reason',
                    value: reason
                }).appendTo('#modificationForm');

                $('#modificationForm').submit();
            });

            // Fermer le modal en cliquant en dehors
            $(window).click(function(event) {
                if (event.target.className === 'modal-overlay') {
                    $('#reasonModal').hide();
                }
            });
        });
    </script>

    <style>
        .form-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .form-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .section-title {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(30,144,255,0.1);
            outline: none;
        }

        .form-control.error {
            border-color: var(--danger-color);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }

        .modal-description {
            color: #666;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .required-field::after {
            content: " *";
            color: var(--danger-color);
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .form-actions .btn {
                width: 100%;
            }
        }
    </style>
</body>
</html>