<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Modifier les Formations</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<div class="container">
    <h1 class="text-center mb-4">Modifier les Formations</h1>
    <form method="post" action="{{ url_for('formation.update_formations') }}">
        {% for f in formations %}
        <div class="form-card">
            <h2 class="card-title">Formation nÂ°{{ f.id_formation }}</h2>

            <div class="form-group">
                <label>Nom</label>
                <input type="text" name="nom_{{ f.id_formation }}" value="{{ f.nom }}" required>
            </div>
            <div class="form-group">
                <label>Type</label>
                <select name="type_{{ f.id_formation }}" required>
                    <option value="initiale" {% if f.type == "initiale" %}selected{% endif %}>Initiale</option>
                    <option value="continue" {% if f.type == "continue" %}selected{% endif %}>Continue</option>
                </select>
            </div>

            <div class="form-group">
                <label>Description</label>
                <textarea name="description_{{ f.id_formation }}" required>{{ f.description }}</textarea>
            </div>
            <div class="form-group">
                <label>DurÃ©e</label>
                <input type="text" name="duree_{{ f.id_formation }}" value="{{ f.duree }}">
            </div>
            <div class="form-group">
                <label>Dates</label>
                <input type="text" name="dates_{{ f.id_formation }}" value="{{ f.dates }}">
            </div>
            <div class="form-group">
                <label>Lieu</label>
                <input type="text" name="lieu_{{ f.id_formation }}" value="{{ f.lieu }}">
            </div>
            <div class="form-group">
                <label>Prix</label>
                <input type="number" name="prix_{{ f.id_formation }}" value="{{ f.prix }}">
            </div>
            <div class="form-group">
                <label>Financement</label>
                <input type="text" name="financement_{{ f.id_formation }}" value="{{ f.financement }}">
            </div>
            <div class="form-group">
                <label>Label</label>
                <input type="text" name="label_{{ f.id_formation }}" value="{{ f.label }}">
            </div>
            <div class="form-group">
                <label>Conditions d'accÃ¨s</label>
                <textarea name="conditions_acces_{{ f.id_formation }}">{{ f.conditions_acces }}</textarea>
            </div>
            <div class="form-group">
                <label>PrÃ©sentation des intervenants</label>
                <textarea name="presentation_intervenants_{{ f.id_formation }}">{{ f.presentation_intervenants }}</textarea>
            </div>
            <div class="form-group">
                <label>Lien d'inscription</label>
                <input type="url" name="lien_inscription_{{ f.id_formation }}" value="{{ f.lien_inscription }}">
            </div>
            <div class="form-group">
                <label>Organisme</label>
                <select name="id_organisme_{{ f.id_formation }}" required>
                    {% for o in organismes %}
                    <option value="{{ o.id_organisme }}" {% if o.id_organisme == f.id_organisme %}selected{% endif %}>
                        {{ o.nom }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label>Ã‰tat</label>
                <button type="button" class="etat-btn" 
                        data-id="{{ f.id_formation }}" 
                        data-state="{{ f.etat }}">
                    {{ "âœ… ValidÃ©" if f.etat == "valide" else "ðŸ•“ En attente" }}
                </button>
                <input type="hidden" name="etat_{{ f.id_formation }}" id="etat_input_{{ f.id_formation }}" value="{{ f.etat }}">
            </div>
        </div>
        <div class="text-center">
            <button type="submit" class="btn btn-success">Enregistrer les modifications</button>
            <a href="/" class="btn btn-secondary">Retour Ã  l'accueil</a>
        </div>
        {% endfor %}
    </form>
</div>

<script>
document.querySelectorAll('.etat-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        const currentState = btn.getAttribute('data-state');
        const newState = currentState === 'valide' ? 'en_attente' : 'valide';
        btn.setAttribute('data-state', newState);
        btn.textContent = newState === 'valide' ? 'âœ… ValidÃ©' : 'ðŸ•“ En attente';
        document.getElementById('etat_input_' + btn.dataset.id).value = newState;
    });
});
</script>

</body>
</html>
